/* calista - v0.0.0 - 2014-02-03 */!function(infuse){"use strict";infuse.version="0.6.9";var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;Array.prototype.contains||(Array.prototype.contains=function(value){for(var i=this.length;i--;)if(this[i]===value)return!0;return!1}),infuse.InjectorError={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself"};var MappingVO=function(prop,value,cl,singleton){this.prop=prop,this.value=value,this.cl=cl,this.singleton=singleton||!1},validateProp=function(prop){if("string"!=typeof prop)throw new Error(infuse.InjectorError.MAPPING_BAD_PROP)},validateValue=function(prop,val){if(void 0===val||null===val)throw new Error(infuse.InjectorError.MAPPING_BAD_VALUE+prop)},validateClass=function(prop,val){if("function"!=typeof val)throw new Error(infuse.InjectorError.MAPPING_BAD_CLASS+prop)},validateBooleanSingleton=function(prop,singleton){if("boolean"!=typeof singleton)throw new Error(infuse.InjectorError.MAPPING_BAD_SINGLETON+prop)},validateConstructorInjectionLoop=function(name,cl){var params=infuse.getConstructorParams(cl);if(params.contains(name))throw new Error(infuse.InjectorError.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},validatePropertyInjectionLoop=function(name,target){if(target.hasOwnProperty(name))throw new Error(infuse.InjectorError.INJECT_INSTANCE_IN_ITSELF_PROPERTY)};infuse.Injector=function(){this.mappings={},this.parent=null},infuse.getConstructorParams=function(cl){function extractName(all,underscore,name){args.push(name)}for(var args=[],clStr=cl.toString().replace(STRIP_COMMENTS,""),argsFlat=clStr.match(FN_ARGS),spl=argsFlat[1].split(FN_ARG_SPLIT),i=0;i<spl.length;i++){var arg=spl[i];arg.replace(FN_ARG,extractName)}return args},infuse.Injector.prototype={createChild:function(){var injector=new infuse.Injector;return injector.parent=this,injector},getMappingVo:function(prop){return this.mappings?this.mappings[prop]?this.mappings[prop]:this.parent?this.parent.getMappingVo(prop):null:null},mapValue:function(prop,val){if(this.mappings[prop])throw new Error(infuse.InjectorError.MAPPING_ALREADY_EXISTS+prop);return validateProp(prop),validateValue(prop,val),this.mappings[prop]=new MappingVO(prop,val,void 0,void 0),this},mapClass:function(prop,cl,singleton){if(this.mappings[prop])throw new Error(infuse.InjectorError.MAPPING_ALREADY_EXISTS+prop);return validateProp(prop),validateClass(prop,cl),singleton&&validateBooleanSingleton(prop,singleton),this.mappings[prop]=new MappingVO(prop,null,cl,singleton),this},removeMapping:function(prop){return this.mappings[prop]=null,delete this.mappings[prop],this},hasMapping:function(prop){return!!this.mappings[prop]},hasInheritedMapping:function(prop){return!!this.getMappingVo(prop)},getMapping:function(value){for(var name in this.mappings)if(this.mappings.hasOwnProperty(name)){var vo=this.mappings[name];if(vo.value===value||vo.cl===value)return vo.prop}return void 0},getValue:function(prop){var vo=this.mappings[prop];if(!vo){if(this.parent)return this.parent.getValue.apply(this.parent,arguments);throw new Error(infuse.InjectorError.NO_MAPPING_FOUND)}if(vo.cl){var args=Array.prototype.slice.call(arguments);return args[0]=vo.cl,vo.singleton?(vo.value||(vo.value=this.createInstance.apply(this,args)),vo.value):this.createInstance.apply(this,args)}return vo.value},getClass:function(prop){var vo=this.mappings[prop];return vo?vo.cl?vo.cl:void 0:this.parent?this.parent.getClass(prop):void 0},instantiate:function(TargetClass){if("function"!=typeof TargetClass)throw new Error(infuse.InjectorError.CREATE_INSTANCE_INVALID_PARAM);for(var args=[null],params=infuse.getConstructorParams(TargetClass),i=0;i<params.length;i++)if(void 0!==arguments[i+1]&&null!==arguments[i+1])args.push(arguments[i+1]);else{var name=params[i],vo=this.getMappingVo(name);if(vo){var val=this.getInjectedValue(vo,name);args.push(val)}else args.push(void 0)}return new(Function.prototype.bind.apply(TargetClass,args))},inject:function(target,isParent){this.parent&&this.parent.inject(target,!0);for(var name in this.mappings)if(this.mappings.hasOwnProperty(name)){var vo=this.getMappingVo(name);(target.hasOwnProperty(vo.prop)||target.constructor&&target.constructor.prototype&&target.constructor.prototype.hasOwnProperty(vo.prop))&&(target[name]=this.getInjectedValue(vo,name))}return"function"!=typeof target.postConstruct||isParent||target.postConstruct(),this},getInjectedValue:function(vo,name){var injectee,val=vo.value;return vo.cl&&(vo.singleton?(vo.value||(validateConstructorInjectionLoop(name,vo.cl),vo.value=this.instantiate(vo.cl),injectee=vo.value),val=vo.value):(validateConstructorInjectionLoop(name,vo.cl),val=this.instantiate(vo.cl),injectee=val)),injectee&&(validatePropertyInjectionLoop(name,injectee),this.inject(injectee)),val},createInstance:function(){var instance=this.instantiate.apply(this,arguments);return this.inject(instance),instance},getValueFromClass:function(cl){for(var name in this.mappings)if(this.mappings.hasOwnProperty(name)){var vo=this.mappings[name];if(vo.cl===cl)return vo.singleton?(vo.value||(vo.value=this.createInstance.apply(this,arguments)),vo.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(infuse.InjectorError.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new Error("Error, you must bind a function.");var args=Array.prototype.slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F,result=target.apply(self,args.concat(Array.prototype.slice.call(arguments)));return Object(result)===result?result:self}return target.apply(that,args.concat(Array.prototype.slice.call(arguments)))};return bound}),"function"==typeof define&&"undefined"!=typeof define.amd&&define("infuse",infuse),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=infuse),"undefined"!=typeof exports&&(exports=infuse)}(this.infuse=this.infuse||{}),function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener,this._isOnce=isOnce,this.context=listenerContext,this._signal=signal,this._priority=priority||0}function validateListener(listener,fnName){if("function"!=typeof listener)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}function Signal(){this._bindings=[],this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}SignalBinding.prototype={active:!0,params:null,execute:function(paramsArr){var handlerReturn,params;return this.active&&this._listener&&(params=this.params?this.params.concat(paramsArr):paramsArr,handlerReturn=this._listener.apply(this.context,params),this._isOnce&&this.detach()),handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},Signal.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(listener,isOnce,listenerContext,priority){var binding,prevIndex=this._indexOfListener(listener,listenerContext);if(-1!==prevIndex){if(binding=this._bindings[prevIndex],binding.isOnce()!==isOnce)throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(isOnce?"Once":"")+"() the same listener without removing the relationship first.")}else binding=new SignalBinding(this,listener,isOnce,listenerContext,priority),this._addBinding(binding);return this.memorize&&this._prevParams&&binding.execute(this._prevParams),binding},_addBinding:function(binding){var n=this._bindings.length;do--n;while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){for(var cur,n=this._bindings.length;n--;)if(cur=this._bindings[n],cur._listener===listener&&cur.context===context)return n;return-1},has:function(listener,context){return-1!==this._indexOfListener(listener,context)},add:function(listener,listenerContext,priority){return validateListener(listener,"add"),this._registerListener(listener,!1,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){return validateListener(listener,"addOnce"),this._registerListener(listener,!0,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),listener},removeAll:function(){for(var n=this._bindings.length;n--;)this._bindings[n]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var bindings,paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length;if(this.memorize&&(this._prevParams=paramsArr),n){bindings=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal,"function"==typeof define&&define.amd?define(function(){return signals}):"undefined"!=typeof module&&module.exports?module.exports=signals:global.signals=signals}(this),function(global){"use strict";var calista=global.calista=global.calista||{version:"0.0.0"},utils=calista.utils={};utils.applyProperties=function(target,extension,bindToExtension,list){if("[object Array]"===Object.prototype.toString.apply(list))for(var i=0,l=list.length;l>i;i++)(void 0===target[list[i]]||null===target[list[i]])&&(target[list[i]]=bindToExtension&&"function"==typeof extension[list[i]]?extension[list[i]].bind(extension):extension[list[i]]);else for(var prop in extension)target[prop]=bindToExtension&&"function"==typeof extension[prop]?extension[prop].bind(extension):extension[prop]},utils.augment=function(target,extension,list){if(extension.prototype&&target.prototype)if("[object Array]"===Object.prototype.toString.apply(list))for(var i=0,l=list.length;l>i;i++)target.prototype[list[i]]||(target.prototype[list[i]]=extension.prototype[list[i]]);else for(var prop in extension.prototype)target.prototype[prop]||(target.prototype[prop]=extension.prototype[prop])},utils.inherit=function(parent,obj){var Subclass;Subclass=obj&&obj.hasOwnProperty("constructor")?obj.constructor:function(){return parent.apply(this,arguments)};var Chain=function(){};return Chain.prototype=parent.prototype,Subclass.prototype=new Chain,obj&&utils.applyProperties(Subclass.prototype,obj),Subclass.prototype.constructor=Subclass,Subclass.parent=parent.prototype,Subclass.extend=function(obj){return utils.inherit(Subclass,obj)},Subclass},utils.extend=function(obj){return utils.inherit(function(){},obj)},"function"==typeof define&&"undefined"!=typeof define.amd&&define("calista",calista),"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=calista:window.calista=calista}(this,this.infuse,this.signals);